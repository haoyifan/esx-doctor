<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>esx-doctor Template Manager</title>
  <link rel="icon" type="image/png" href="/icon.png" />
  <link rel="stylesheet" href="/styles.css" />
  <style>
    .tm-wrap { max-width: 1200px; margin: 16px auto; padding: 0 12px; }
    .tm-grid { display: grid; grid-template-columns: 340px 1fr; gap: 12px; }
    .tm-panel { border: 1px solid var(--border); border-radius: 10px; background: var(--panel); padding: 12px; }
    .tm-list { max-height: 70vh; overflow: auto; border: 1px solid var(--border); border-radius: 8px; background: var(--list-bg); }
    .tm-item { padding: 8px; border-bottom: 1px solid var(--border); cursor: pointer; }
    .tm-item:last-child { border-bottom: 0; }
    .tm-item.active { background: rgba(93,214,199,0.12); }
    .tm-item-title { font-weight: 600; font-size: 13px; }
    .tm-item-meta { color: var(--muted); font-size: 11px; }
    .tm-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .tm-full { grid-column: 1 / -1; }
    .tm-conditions { border: 1px solid var(--border); border-radius: 8px; padding: 8px; background: var(--list-bg); }
    .tm-cond-row { display: grid; grid-template-columns: 120px 130px 1fr auto; gap: 8px; margin-bottom: 8px; }
    .tm-cond-row:last-child { margin-bottom: 0; }
    .tm-toolbar { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; }
    .tm-small { font-size: 11px; color: var(--muted); }
    @media (max-width: 980px) { .tm-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="tm-wrap">
    <div class="brand" style="margin-bottom:10px;">
      <img class="brand-logo" src="/icon.png" alt="esx-doctor logo" />
      <div class="title">Template Manager</div>
    </div>
    <div class="tm-grid">
      <section class="tm-panel">
        <div class="tm-toolbar">
          <button id="tmNew" class="btn ghost" type="button">New</button>
          <button id="tmDuplicate" class="btn ghost" type="button">Duplicate</button>
          <button id="tmDelete" class="btn ghost" type="button">Delete</button>
          <button id="tmExport" class="btn ghost" type="button">Export JSON</button>
          <label class="btn ghost" style="display:inline-flex;align-items:center;cursor:pointer;">
            Import JSON
            <input id="tmImport" type="file" accept="application/json" style="display:none;" />
          </label>
        </div>
        <div id="tmList" class="tm-list"></div>
      </section>

      <section class="tm-panel">
        <div class="tm-form-grid">
          <div>
            <label class="sub-label" for="tmName">Name</label>
            <input id="tmName" type="text" />
          </div>
          <div>
            <label class="sub-label" for="tmSeverity">Severity</label>
            <select id="tmSeverity">
              <option value="critical">critical</option>
              <option value="high">high</option>
              <option value="medium">medium</option>
              <option value="low">low</option>
            </select>
          </div>
          <div class="tm-full">
            <label class="sub-label" for="tmDesc">Description</label>
            <input id="tmDesc" type="text" />
          </div>
          <div>
            <label class="sub-label" for="tmType">Pattern Type</label>
            <select id="tmType">
              <option value="threshold_sustained">Sustained Threshold</option>
              <option value="zigzag_switch">Zig-Zag / Dominance Switch</option>
              <option value="dominance_imbalance">Dominance Imbalance</option>
              <option value="exclusive_affinity">Boolean Active Flag</option>
            </select>
          </div>
          <div>
            <label class="sub-label" for="tmAttribute">Attribute</label>
            <select id="tmAttribute"></select>
          </div>
          <div>
            <label class="sub-label" for="tmEnabled">Enabled by default</label>
            <select id="tmEnabled">
              <option value="true">true</option>
              <option value="false">false</option>
            </select>
          </div>
          <div>
            <label class="sub-label" for="tmFilterLogic">Filter Logic</label>
            <select id="tmFilterLogic">
              <option value="and">ALL conditions (AND)</option>
              <option value="or">ANY condition (OR)</option>
            </select>
          </div>
          <div class="tm-full">
            <label class="sub-label">Filter Conditions</label>
            <div id="tmConditions" class="tm-conditions"></div>
            <div class="controls tight">
              <button id="tmAddCondition" type="button" class="btn ghost">Add Condition</button>
            </div>
            <div class="tm-small">Instance filters only. Use AND/OR to combine conditions.</div>
          </div>

          <div id="tmThresholdParams" class="tm-full">
            <div class="tm-form-grid">
              <div>
                <label class="sub-label" for="tmThreshold">Threshold</label>
                <input id="tmThreshold" type="number" step="0.01" />
              </div>
              <div>
                <label class="sub-label" for="tmComparison">Comparison</label>
                <select id="tmComparison">
                  <option value="greater">greater than</option>
                  <option value="less">less than</option>
                </select>
              </div>
              <div>
                <label class="sub-label" for="tmMinConsecutive">Min Consecutive Samples</label>
                <input id="tmMinConsecutive" type="number" min="1" step="1" value="6" />
              </div>
            </div>
          </div>

          <div id="tmZigzagParams" class="tm-full" style="display:none;">
            <div class="tm-form-grid">
              <div>
                <label class="sub-label" for="tmMinSwitches">Min Switches</label>
                <input id="tmMinSwitches" type="number" min="1" step="1" value="6" />
              </div>
              <div>
                <label class="sub-label" for="tmMinGap">Min Gap</label>
                <input id="tmMinGap" type="number" step="0.01" value="3" />
              </div>
            </div>
          </div>

          <div id="tmImbalanceParams" class="tm-full" style="display:none;">
            <div class="tm-form-grid">
              <div>
                <label class="sub-label" for="tmHighThreshold">High Threshold</label>
                <input id="tmHighThreshold" type="number" step="0.01" value="80" />
              </div>
              <div>
                <label class="sub-label" for="tmLowThreshold">Low Threshold</label>
                <input id="tmLowThreshold" type="number" step="0.01" value="20" />
              </div>
              <div>
                <label class="sub-label" for="tmImbalanceGap">Min Gap</label>
                <input id="tmImbalanceGap" type="number" step="0.01" value="45" />
              </div>
              <div>
                <label class="sub-label" for="tmImbalanceConsecutive">Min Consecutive Samples</label>
                <input id="tmImbalanceConsecutive" type="number" min="1" step="1" value="6" />
              </div>
            </div>
          </div>
        </div>

        <div class="controls" style="margin-top:14px;">
          <button id="tmSave" class="btn primary" type="button">Save Template</button>
        </div>
        <div id="tmStatus" class="muted" style="margin-top:8px;"></div>
      </section>
    </div>
  </div>
  <script src="/templates.js"></script>
</body>
</html>
